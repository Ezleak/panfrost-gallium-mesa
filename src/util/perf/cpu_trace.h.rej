diff a/src/util/perf/cpu_trace.h b/src/util/perf/cpu_trace.h	(rejected hunks)
@@ -7,24 +7,25 @@
 #define CPU_TRACE_H
 
 #include "u_perfetto.h"
+#include "u_gpuvis.h"
 
 #include "util/macros.h"
 
 #if defined(HAVE_PERFETTO)
 
-/* note that util_perfetto_is_category_enabled always returns false util
+/* note that util_perfetto_is_tracing_enabled always returns false util
  * util_perfetto_init is called
  */
-#define _MESA_TRACE_BEGIN(category, name)                                    \
+#define _MESA_TRACE_BEGIN(name)                                              \
    do {                                                                      \
-      if (unlikely(util_perfetto_is_category_enabled(category)))             \
-         util_perfetto_trace_begin(category, name);                          \
+      if (unlikely(util_perfetto_is_tracing_enabled()))                      \
+         util_perfetto_trace_begin(name);                                    \
    } while (0)
 
-#define _MESA_TRACE_END(category)                                            \
+#define _MESA_TRACE_END()                                                    \
    do {                                                                      \
-      if (unlikely(util_perfetto_is_category_enabled(category)))             \
-         util_perfetto_trace_end(category);                                  \
+      if (unlikely(util_perfetto_is_tracing_enabled()))                      \
+         util_perfetto_trace_end();                                          \
    } while (0)
 
 /* NOTE: for now disable atrace for C++ to workaround a ndk bug with ordering
@@ -36,17 +37,29 @@
 
 #include <cutils/trace.h>
 
-#define _MESA_TRACE_BEGIN(category, name)                                    \
+#define _MESA_TRACE_BEGIN(name)                                              \
    atrace_begin(ATRACE_TAG_GRAPHICS, name)
-#define _MESA_TRACE_END(category) atrace_end(ATRACE_TAG_GRAPHICS)
+#define _MESA_TRACE_END() atrace_end(ATRACE_TAG_GRAPHICS)
 
 #else
 
-#define _MESA_TRACE_BEGIN(category, name)
-#define _MESA_TRACE_END(category)
+#define _MESA_TRACE_BEGIN(name)
+#define _MESA_TRACE_END()
 
 #endif /* HAVE_PERFETTO */
 
+#if defined(HAVE_GPUVIS)
+
+#define _MESA_GPUVIS_TRACE_BEGIN(name) util_gpuvis_begin(name)
+#define _MESA_GPUVIS_TRACE_END() util_gpuvis_end()
+
+#else
+
+#define _MESA_GPUVIS_TRACE_BEGIN(name)
+#define _MESA_GPUVIS_TRACE_END()
+
+#endif /* HAVE_GPUVIS */
+
 #if __has_attribute(cleanup) && __has_attribute(unused)
 
 #define _MESA_TRACE_SCOPE_VAR_CONCAT(name, suffix) name##suffix
