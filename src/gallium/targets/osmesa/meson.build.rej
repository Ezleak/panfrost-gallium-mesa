diff a/src/gallium/targets/osmesa/meson.build b/src/gallium/targets/osmesa/meson.build	(rejected hunks)
@@ -57,13 +57,25 @@ libosmesa = shared_library(
   dependencies : [
     dep_ws2_32, dep_selinux, dep_thread, dep_clock, dep_unwind, driver_swrast
   ],
-  name_prefix : host_machine.system() == 'windows' ? '' : 'lib',  # otherwise mingw will create libosmesa.dll
+  name_prefix : host_machine.system() == 'windows' ? '' : [],  # otherwise mingw will create libosmesa.dll
   soversion : host_machine.system() == 'windows' ? '' : '8',
   version : '8.0.0',
   darwin_versions : '9.0.0',
   install : true,
 )
 
+if with_symbols_check
+  test('osmesa-symbols-check',
+    symbols_check,
+    args : [
+      '--lib', libosmesa,
+      '--symbols-file', files('osmesa-symbols.txt'),
+      symbols_check_args,
+    ],
+    suite : ['gallium'],
+  )
+endif
+
 pkg.generate(
   name : 'osmesa',
   description : 'Mesa Off-screen Rendering Library',
